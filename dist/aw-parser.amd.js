!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.awParser=t():e.awParser=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){var n={},r={operators:n};n.is=function(){return-1!==Array.prototype.slice.call(arguments).indexOf(this.type)},n.is_dialogue=function(){return this.is("character","parenthetical","dialogue")},n.name=function(){var e=this.text,t=e.indexOf("(");return-1!==t&&(e=e.substring(0,t)),e=e.trim()},n.location=function(){var e=this.text.trim(),t=(e=e.replace(/^(INT\.?\/EXT\.?)|(I\/E)|(INT\.?)|(EXT\.?)/,"")).lastIndexOf(" - ");return-1!==t&&(e=e.substring(0,t)),e.trim()},n.has_scene_time=function(e){var t=this.text.substring(this.text.indexOf(" - "));return this.is("scene_heading")&&-1!==t.indexOf(e)},n.location_type=function(){var e=this.text.trim();return/^I(NT.?)?\/E(XT.?)?/.test(e)?"mixed":/^INT.?/.test(e)?"int":/^EXT.?/.test(e)?"ext":"other"};var i=function(e,t){return function(){return e.token?e.token[t].apply(e.token,arguments):null}},o=function(e){return function(){var t=arguments;return function(n){return n[e].apply(n,t)}}};for(var a in r.fq={},n)r.fq[a]=o(a);r.first_text=function(e,t,n){for(var r=0;r<t.length;r++)if(t[r].type===e)return t[r].text;return n},r.create_line=function(e){return e.text=e.text||"",e.type=e.type||"unknown",e.start=e.start||0,e.end=e.end||0,e.token=e.token||r.create_token({type:e.type}),e.token.lines=e.token.lines||[e],function(e){for(var t in n)e[t]=i(e,t);return e}(e)},r.create_token=function(e){return e.text=e.text||"",e.type=e.type||"unknown",e.start=e.start||0,e.end=e.end||0,e.lines=e.lines||[],function(e){for(var t in n)e[t]=n[t];return e}(e)},r.create_separator=function(e,t){return r.create_token({text:"",start:e,end:t,lines:[""],type:"separator"})},e.exports=r},function(e,t,n){var r=n(2),i=n(0);e.exports={parser:r,helpers:i}},function(e,t,n){var r=n(0),i={},o={title_page:/(title|credit|author[s]?|source|notes|draft date|date|contact|copyright)\:.*/i,section:/^(#+)(?: *)(.*)/,synopsis:/^(?:\=(?!\=+) *)(.*)/,scene_heading:/^((?:\*{0,3}_?)?(?:(?:int|ext|est|int\/ext|i\.?\/e\.?)[. ]).+)|^(?:\.(?!\.+))(.+)/i,scene_number:/#(.+)#/,transition:/^((?:FADE (?:TO BLACK|OUT)|CUT TO BLACK)\.|.+ TO\:|^TO\:$)|^(?:> *)(.+)/,dialogue:/^([A-Z*_]+[0-9A-Z (._\-')]*)(\^?)?(?:\n(?!\n+))([\s\S]+)/,character:/^([A-Z*_]+[0-9A-Z (._\-')]*)\^?$|^@.*$/,parenthetical:/^(\(.+\))$/,action:/^(.+)/g,centered:/^(?:> *)(.+)(?: *<)(\n.+)*/g,page_break:/^\={3,}$/,line_break:/^ {2}$/};i.parse=function(e,t){var n=e,i={title_page:[],tokens:[]};if(!n)return i;var a=n.match(/\r\n/)?2:1;t.print_notes||(n=n.replace(/ {0,1}\[\[/g," /*").replace(/\]\] {0,1}/g,"*/"));for(var s,c,p,u,l,f,x,d=n.split(/\r\n|\r|\n/),_=function(e,t,n){return r.create_token({text:e,start:t,end:t+e.length-1+a,line:n})},g=d.length,h=0,y=1,m=!1,b=!1,k="none",v="normal",O=0,T=!1,j=function(e,t){return"/*"===t?O++:"*/"===t?O--:O||(e+=t),e},w=function(e){return e},A=0;A<g;A++)if(c=(c=d[A]).split(/(\/\*){1}|(\*\/){1}|([^\/\*]+)/g).filter(w).reduce(j,""),O&&"ignore"!==v?(x=v,v="ignore"):"ignore"===v&&(v=x),0===O&&"ignore"===v&&(v=x),h=(u=_(c,h,A)).end+1,0!==c.trim().length||"  "===c){if(b=m||0===A,k="script",!T&&o.title_page.test(u.text)&&(v="title_page"),"title_page"===v){if(o.title_page.test(u.text)){var P=u.text.indexOf(":");u.type=u.text.substr(0,P).toLowerCase(),u.text=u.text.substr(P+1).trim(),p=u,i.title_page.push(u),T=!0;continue}if(T){p.text+=(p.text?"\n":"")+u.text.trim();continue}}if("normal"===v)if(u.text.match(o.line_break))k="none";else if(u.text.match(o.scene_heading)){if(u.text=u.text.replace(/^\./,""),t.each_scene_on_new_page&&1!==y){var C=r.create_token({type:"page_break",start:u.start,end:u.end});i.tokens.push(C)}u.type="scene_heading",u.number=y,(s=u.text.match(o.scene_number))&&(u.text=u.text.replace(o.scene_number,""),u.number=s[1]),y++}else if(u.text.match(o.centered))u.type="centered",u.text=u.text.replace(/>|</g,"").trim();else if(u.text.match(o.transition))u.text=u.text.replace(/> ?/,""),u.type="transition";else if(s=u.text.match(o.synopsis))u.text=s[1],u.type=u.text?"synopsis":"separator";else if(s=u.text.match(o.section))u.level=s[1].length,u.text=s[2],u.type="section";else if(u.text.match(o.page_break))u.text="",u.type="page_break";else if(u.text.length&&"!"===u.text[0])u.type="action",u.text=u.text.substr(1);else if(u.text.length>0&&"@"===u.text[0]||u.text===u.text.toUpperCase()&&b)if(A===g||A===g-1||0===d[A+1].trim().length)u.type="shot";else{if(v="dialogue",u.type="character",u.text=u.text.replace(/^@/,""),"^"===u.text[u.text.length-1]){if(t.use_dual_dialogue){for(var E=["dialogue","character","parenthetical"];-1!==E.indexOf(i.tokens[l].type);)i.tokens[l].dual="left",l++;u.dual="right",f=!0}u.text=u.text.replace("^","")}l=i.tokens.length}else u.type="action";else u.text.match(o.parenthetical)?u.type="parenthetical":u.type="dialogue",f&&(u.dual="right");m=!1,"script"===k&&"ignore"!==v&&(u.is("scene_heading","transition")&&(u.text=u.text.toUpperCase(),T=!0),u.text&&"~"===u.text[0]&&(u.text="*"+u.text.substr(1)+"*"),u.text=u.is("action")?u.text:u.text.trim(),i.tokens.push(u))}else{if(v="normal",t.merge_multiple_empty_lines&&m||"title_page"===v)continue;f=!1,u.type="separator",m=!0,i.tokens.push(u)}for(var I=0,S=null;I<i.tokens.length;){var $=i.tokens[I];if(!t.print_actions&&$.is("action","transition","centered","shot")||!t.print_notes&&"note"===$.type||!t.print_headers&&"scene_heading"===$.type||!t.print_sections&&"section"===$.type||!t.print_synopsis&&"synopsis"===$.type||!t.print_dialogues&&$.is_dialogue()||t.merge_multiple_empty_lines&&$.is("separator")&&"separator"===S)i.tokens.splice(I,1);else{if(t.double_space_between_scenes&&$.is("scene_heading")&&1!==$.number){var M=r.create_separator(u.start,u.end);i.tokens.splice(I,0,M),I++}S=$.type,I++}}for(;i.tokens.length>0&&"separator"===i.tokens[i.tokens.length-1].type;)i.tokens.pop();return i},e.exports=i}])});